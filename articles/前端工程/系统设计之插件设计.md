# 系统设计之插件模式

此为总结类文章，原文看 [这里](https://mp.weixin.qq.com/s/XCuwd9QapErkoVZBoap6-w)。

## 了解插件模式

### 目的

为了保证系统的可扩展性，以面对未来功能的不确定性。

- 为系统提供全新的能力
- 对系统现有能力进行定制

### 要求

- 插件代码与系统代码在工程上解耦，可以独立开发，并对开发者隔离框架内部逻辑的复杂度
- 可动态化引入与配置

### 插件所要解决的问题

- 为系统提供全新的能力
- 对系统现有能力进行定制

插件在运行时被引入系统，由 `系统` 控制调度。一个系统可以存在复数个插件，这些插件可通过系统预定的方式进行组合。



## 怎么实现插件模式

1. 定义问题
2. 架构设计

### 1. 定义问题

一个思想：系统实现确定性机制，插件解决不确定性问题。

### 2. 架构设计

1. 如何注入、配置、初始化插件
2. 插件如何影响系统
3. 插件输入输出的含义与可以使用的能力
4. 复数个插件之间的关系是怎么样的

#### 如何注入、配置、初始化插件

##### 注入

+ 声明式：系统按照配置规则读取插件并注入，例如webpack
+ 编程式：开发人员调用注入api注入组件

##### 配置

+ 插件暴露工厂函数接受配置参数
+ 通过插件运行的上下文获取配置参数

##### 初始化

考虑初始化的方式，推荐统一初始化。有利于系统的调度。

#### 插件如何影响系统

插件对系统的影响我们可以总结为三方面：**行为、交互、展示**

+ 直接调用
+ 钩子机制
+ 使用者调度机制

#### 插件输入输出的含义与可以使用的能力

##### 可以使用的能力

+ 纯工具：不影响系统状态
+ 获取当前系统状态
+ 修改当前系统状态
+ API 形式注入功能：例如注册 UI，注册事件等

##### 输入输出

***意料之中的输入，坚信不疑的输出\***

考量输入输出的粒度。

#### 复数个插件之间的关系是怎么样的

+ 覆盖式
+ 管道式
+ 洋葱圈式
+ 集散式
